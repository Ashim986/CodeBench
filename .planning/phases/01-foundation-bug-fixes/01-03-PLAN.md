---
phase: 01-foundation-bug-fixes
plan: 03
type: execute
wave: 2
depends_on: [01-01, 01-02]
files_modified:
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+CombinedList.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+DiffHighlights.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Labels.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+ListStructure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Pointers.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Structure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+TreeStructure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneySequenceBubbleRow.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneySequenceBubbleRow+Layout.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceValueView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStringSequenceView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyDictionaryStructureRow.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyVariableTimeline.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyVariableTimeline+Rendering.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Layout.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Playback.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Selection.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Interaction.swift
autonomous: true
requirements: [REQ-F01, REQ-F02]

must_haves:
  truths:
    - "All visualization files use `import LeetPulseDesignSystem` and reference DS tokens for colors"
    - "No hardcoded Color literals (Color.red, Color.blue, .green, etc.) remain in visualization views"
    - "No hardcoded Font literals (.system(size:), .caption, .footnote) remain -- DS typography or VizTypography used"
    - "Diff colors use DS tokens: success green (added), danger red at 25% opacity (removed), warning amber (modified)"
    - "Light and dark theme both work through DS theme tokens"
    - "All 14 renderers audited for remaining UUID/layout/hardcoded issues"
  artifacts:
    - path: "CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift"
      provides: "Graph view using DS color/typography tokens"
      contains: "import LeetPulseDesignSystem"
    - path: "CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift"
      provides: "Bubble renderer using DS diff colors"
      contains: "theme.colors"
    - path: "CodeBench/CodeBench/DataJourney/Views/DataJourneySequenceBubbleRow.swift"
      provides: "Array/sequence renderer using DS tokens"
      contains: "import LeetPulseDesignSystem"
  key_links:
    - from: "@Environment(\\.dsTheme) var theme"
      to: "theme.colors.*, theme.vizColors.*, theme.typography.*"
      via: "SwiftUI environment injection from LeetPulseDesignSystem"
      pattern: "theme\\.(colors|vizColors|typography)"
    - from: "DSBubbleChangeType"
      to: "TraceBubble ChangeType"
      via: "Aligned naming -- local ChangeType uses DS color tokens for overlays"
      pattern: "theme\\.colors\\.(success|danger|warning)"
---

<objective>
Replace all hardcoded styling in visualization files with LeetPulseDesignSystem tokens and audit all 14 renderers for remaining issues.

Purpose: Establish single source of truth for colors, typography, and spacing across all visualization code. Enable automatic light/dark theme support and colorblind-safe categorical colors. This is the "full sweep" required by the user's locked decisions.
Output: All 27 visualization view files use DS tokens. Zero hardcoded color/font/size values in visualization code.
</objective>

<execution_context>
@/Users/ashimdahal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashimdahal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-bug-fixes/01-RESEARCH.md
@.planning/phases/01-foundation-bug-fixes/01-01-SUMMARY.md
@.planning/phases/01-foundation-bug-fixes/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DS imports and replace hardcoded colors/fonts in graph, tree, trie, and structure canvas views</name>
  <files>
    CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+CombinedList.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+DiffHighlights.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Labels.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+ListStructure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Pointers.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Structure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+TreeStructure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift
  </files>
  <action>
For each file listed:

1. Add `import LeetPulseDesignSystem` at the top (or `import LeetPulseDesignSystemCore`).

2. Add `@Environment(\.dsTheme) var theme` to each View struct that doesn't already have it.

3. Replace all hardcoded color references with DS tokens using this mapping (from 01-RESEARCH.md):

**Color replacements:**
- `Color.red`, `.red` -> `theme.colors.danger`
- `Color.green`, `.green` -> `theme.colors.success`
- `Color.blue`, `.blue` -> `theme.colors.primary`
- `Color.yellow`, `.yellow`, `Color.orange` -> `theme.colors.warning`
- `Color.gray`, `.gray`, `Color.secondary` -> `theme.colors.textSecondary`
- `Color.white` -> `theme.colors.surface` or `theme.colors.foregroundOnViz`
- `Color.black` -> `theme.colors.textPrimary`
- `Color.clear` -> keep as `Color.clear` (transparent is universal)
- `Color(.systemBackground)` -> `theme.colors.background`

**Diff/change colors (per user decision):**
- Added/new -> `theme.colors.success` (green #16A349 light / #49DD7F dark)
- Removed -> `theme.colors.danger.opacity(0.25)` (red at 25% opacity per user decision)
- Modified -> `theme.colors.warning` (amber #F49E0A / #F9BF35)
- Unchanged -> no overlay

**Categorical visualization colors (for data structure node coloring):**
- Use `theme.vizColors.primary`, `.secondary`, `.tertiary`, etc. (Okabe-Ito colorblind-safe palette)
- Per user decision: "Use Okabe-Ito colorblind-safe palette for categorical visualization needs"

4. Replace hardcoded font references:
- `.system(size: N)` for visualization text -> keep `VizTypography` constants (per research: "Keep VizTypography.swift as a CodeBench-specific extension")
- `.caption`, `.footnote`, `.headline` for UI text -> `theme.typography.caption`, `theme.typography.subtitle`, etc.
- `.monospaced`, `.system(.body, design: .monospaced)` -> `theme.typography.mono`

5. Replace hardcoded spacing/padding:
- Numeric padding/spacing values -> `theme.spacing.xs`, `.sm`, `.md`, `.lg` where appropriate
- Keep visualization-specific tight spacing (1-4pt) as-is -- DS spacing tokens are for UI chrome, not dense visualization layout

6. **TraceBubble ChangeType alignment**: In DataJourneyTraceBubble.swift, align the local `ChangeType` enum with `DSBubbleChangeType` naming conventions. Use DS color tokens for change overlays:
   - `.added` -> `theme.colors.success`
   - `.removed` -> `theme.colors.danger.opacity(0.25)`
   - `.modified` -> `theme.colors.warning`
   - `.unchanged` -> no overlay
   Per research: "Keep TraceBubble as the local renderer (CodeBench-specific rendering logic). Align local ChangeType with DSBubbleChangeType naming, use DS color tokens for overlays."

7. While in each file, audit for any remaining issues:
   - Any UUID() patterns missed by Plan 02
   - Any layout computation still in body
   - Any accessibility issues (missing labels, contrast problems)
   Note findings but only fix what's within scope (colors/fonts/spacing).
  </action>
  <verify>
1. `grep -rn "import LeetPulseDesignSystem" CodeBench/CodeBench/DataJourney/Views/` returns matches in all modified view files
2. `grep -rn "Color\.red\|Color\.green\|Color\.blue\|Color\.yellow\|Color\.orange\|Color\.gray\|\.red\b\|\.green\b\|\.blue\b" CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView*.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift` returns zero color literal matches (excluding Color.clear)
3. `grep -rn "dsTheme" CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift` confirms environment theme is declared
  </verify>
  <done>Graph, tree, trie, structure canvas, heap, matrix, and bubble views all use DS tokens for colors, typography, and spacing. Diff colors use success/danger(25%)/warning per user decision. VizTypography kept for dense visualization text. All 14 files audited during sweep.</done>
</task>

<task type="auto">
  <name>Task 2: Replace hardcoded styling in sequence, string, dictionary, timeline, and main DataJourney views</name>
  <files>
    CodeBench/CodeBench/DataJourney/Views/DataJourneySequenceBubbleRow.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneySequenceBubbleRow+Layout.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStringSequenceView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyDictionaryStructureRow.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceValueView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyVariableTimeline.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyVariableTimeline+Rendering.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Layout.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Playback.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Selection.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyView+Interaction.swift
  </files>
  <action>
Apply the same DS token replacement pattern from Task 1 to the remaining visualization files:

1. Add `import LeetPulseDesignSystem` to each file.
2. Add `@Environment(\.dsTheme) var theme` to each View struct.
3. Replace all hardcoded Color, Font, and spacing values using the same mapping from Task 1.

**Specific attention areas:**

- **DataJourneySequenceBubbleRow.swift**: Array element colors, index labels, pointer badge colors. Use `theme.vizColors.*` for categorical element coloring.

- **DataJourneyStringSequenceView.swift**: Character cell colors, highlight colors for matched/unmatched characters.

- **DataJourneyDictionaryStructureRow.swift**: Key-value pair styling, separator colors.

- **DataJourneyTraceValueView.swift**: Value display colors for different TraceValue types (numbers, strings, booleans, nulls).

- **DataJourneyVariableTimeline.swift + Rendering**: Event timeline colors, selection highlights, step indicators. Use `theme.colors.primary` for selection, `theme.colors.surfaceElevated` for timeline background.

- **DataJourneyView.swift + extensions**: Main container colors, section backgrounds, divider colors.

- **DataJourneyView+Playback.swift**: Playback control button colors, progress indicator, step counter text.

4. After completing all files, run a comprehensive grep to confirm zero hardcoded styling remains:
   ```bash
   grep -rn "Color\.\(red\|green\|blue\|yellow\|orange\|gray\|white\|black\)" CodeBench/CodeBench/DataJourney/Views/
   grep -rn "\.system(size:" CodeBench/CodeBench/DataJourney/Views/
   ```
   Expected: Zero matches (except VizTypography.swift which is intentionally kept, and Color.clear which is universal).

5. While in each file, audit for any remaining issues beyond styling and note them. Do not fix non-styling issues in this plan.

Per user decision: "ALL visualization styling (colors, typography, spacing) must come from the design system -- no hardcoded values."
Exception: VizTypography.swift is kept per research recommendation as a CodeBench-specific extension for dense visualization text sizes.
  </action>
  <verify>
1. `grep -rn "import LeetPulseDesignSystem" CodeBench/CodeBench/DataJourney/Views/` returns matches in ALL view files (27 files total, minus VizTypography.swift which is a constants file)
2. `grep -rn "Color\.\(red\|green\|blue\|yellow\|orange\|gray\|white\|black\)" CodeBench/CodeBench/DataJourney/Views/ | grep -v "VizTypography\|Color\.clear"` returns zero results
3. `grep -rn "\.system(size:" CodeBench/CodeBench/DataJourney/Views/ | grep -v "VizTypography"` returns zero results
4. `grep -rn "dsTheme" CodeBench/CodeBench/DataJourney/Views/DataJourneyView.swift` confirms theme environment variable present
  </verify>
  <done>All visualization view files use DS tokens. Zero hardcoded Color/Font/size literals remain (except VizTypography.swift for dense viz text and Color.clear). Both light and dark themes work through DS tokens. Full audit of all 14 renderers completed.</done>
</task>

</tasks>

<verification>
1. All 27 visualization view files have `import LeetPulseDesignSystem`
2. `grep -rn "Color\.\(red\|green\|blue\|yellow\|orange\|gray\|white\|black\)" CodeBench/CodeBench/DataJourney/Views/ | grep -v VizTypography | grep -v Color.clear` returns zero results
3. `grep -rn "\.system(size:" CodeBench/CodeBench/DataJourney/Views/ | grep -v VizTypography` returns zero results
4. Diff colors are: success green (added), danger red at 25% opacity (removed), warning amber (modified)
5. Categorical visualization uses Okabe-Ito palette from DS vizColors
6. Xcode project builds without errors
</verification>

<success_criteria>
- Every visualization view file imports LeetPulseDesignSystem and uses @Environment(\.dsTheme)
- Zero hardcoded Color/Font literals in visualization code (except VizTypography and Color.clear)
- Diff overlays use DS success/danger(25%)/warning tokens
- Categorical colors use Okabe-Ito vizColors
- All 14 renderers audited -- no remaining UUID or layout-in-body issues
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-bug-fixes/01-03-SUMMARY.md`
</output>
