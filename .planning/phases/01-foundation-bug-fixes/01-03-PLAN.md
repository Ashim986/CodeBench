---
phase: 01-foundation-bug-fixes
plan: 03
type: execute
wave: 2
depends_on: [01-01, 01-02]
files_modified:
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+CombinedList.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+DiffHighlights.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Labels.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+ListStructure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Pointers.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Structure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+TreeStructure.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift
  - CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift
autonomous: true
requirements: [REQ-F01, REQ-F02]

must_haves:
  truths:
    - "Graph, tree, trie, and structure canvas views use `import LeetPulseDesignSystem` and reference DS tokens for colors"
    - "No hardcoded Color literals remain in the 14 files touched by this plan"
    - "Diff colors use DS tokens: success green (added), danger red at 25% opacity (removed), warning amber (modified)"
    - "TraceBubble ChangeType aligned with DSBubbleChangeType naming and uses DS color tokens"
    - "Light and dark theme both work through DS theme tokens in these views"
  artifacts:
    - path: "CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift"
      provides: "Graph view using DS color/typography tokens"
      contains: "import LeetPulseDesignSystem"
    - path: "CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift"
      provides: "Bubble renderer using DS diff colors"
      contains: "theme.colors"
  key_links:
    - from: "@Environment(\\.dsTheme) var theme"
      to: "theme.colors.*, theme.vizColors.*, theme.typography.*"
      via: "SwiftUI environment injection from LeetPulseDesignSystem"
      pattern: "theme\\.(colors|vizColors|typography)"
    - from: "DSBubbleChangeType"
      to: "TraceBubble ChangeType"
      via: "Aligned naming -- local ChangeType uses DS color tokens for overlays"
      pattern: "theme\\.colors\\.(success|danger|warning)"
---

<objective>
Replace all hardcoded styling in graph, tree, trie, structure canvas, heap, matrix, and bubble views with LeetPulseDesignSystem tokens.

Purpose: First half of the "full sweep" -- migrate the graph/tree/trie renderers and their supporting structure canvas extensions to DS tokens. Establishes the pattern for the remaining views in Plan 04.
Output: 14 visualization view files use DS tokens for colors, typography, and spacing. Diff overlays use DS color tokens.
</objective>

<execution_context>
@/Users/ashimdahal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ashimdahal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-bug-fixes/01-RESEARCH.md
@.planning/phases/01-foundation-bug-fixes/01-01-SUMMARY.md
@.planning/phases/01-foundation-bug-fixes/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DS imports and replace hardcoded colors/fonts in graph, tree, trie, and structure canvas views</name>
  <files>
    CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+CombinedList.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+DiffHighlights.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Labels.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+ListStructure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Pointers.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+Structure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView+TreeStructure.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift,
    CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift
  </files>
  <action>
For each file listed:

1. Add `import LeetPulseDesignSystem` at the top (or `import LeetPulseDesignSystemCore`).

2. Add `@Environment(\.dsTheme) var theme` to each View struct that doesn't already have it.

3. Replace all hardcoded color references with DS tokens using this mapping (from 01-RESEARCH.md):

**Color replacements:**
- `Color.red`, `.red` -> `theme.colors.danger`
- `Color.green`, `.green` -> `theme.colors.success`
- `Color.blue`, `.blue` -> `theme.colors.primary`
- `Color.yellow`, `.yellow`, `Color.orange` -> `theme.colors.warning`
- `Color.gray`, `.gray`, `Color.secondary` -> `theme.colors.textSecondary`
- `Color.white` -> `theme.colors.surface` or `theme.colors.foregroundOnViz`
- `Color.black` -> `theme.colors.textPrimary`
- `Color.clear` -> keep as `Color.clear` (transparent is universal)
- `Color(.systemBackground)` -> `theme.colors.background`

**Diff/change colors (per user decision):**
- Added/new -> `theme.colors.success` (green #16A349 light / #49DD7F dark)
- Removed -> `theme.colors.danger.opacity(0.25)` (red at 25% opacity per user decision)
- Modified -> `theme.colors.warning` (amber #F49E0A / #F9BF35)
- Unchanged -> no overlay

**Categorical visualization colors (for data structure node coloring):**
- Use `theme.vizColors.primary`, `.secondary`, `.tertiary`, etc. (Okabe-Ito colorblind-safe palette)
- Per user decision: "Use Okabe-Ito colorblind-safe palette for categorical visualization needs"

4. Replace hardcoded font references:
- `.system(size: N)` for visualization text -> keep `VizTypography` constants (per research: "Keep VizTypography.swift as a CodeBench-specific extension")
- `.caption`, `.footnote`, `.headline` for UI text -> `theme.typography.caption`, `theme.typography.subtitle`, etc.
- `.monospaced`, `.system(.body, design: .monospaced)` -> `theme.typography.mono`

5. Replace hardcoded spacing/padding:
- Numeric padding/spacing values -> `theme.spacing.xs`, `.sm`, `.md`, `.lg` where appropriate
- Keep visualization-specific tight spacing (1-4pt) as-is -- DS spacing tokens are for UI chrome, not dense visualization layout

6. **TraceBubble ChangeType alignment**: In DataJourneyTraceBubble.swift, align the local `ChangeType` enum with `DSBubbleChangeType` naming conventions. Use DS color tokens for change overlays:
   - `.added` -> `theme.colors.success`
   - `.removed` -> `theme.colors.danger.opacity(0.25)`
   - `.modified` -> `theme.colors.warning`
   - `.unchanged` -> no overlay
   Per research: "Keep TraceBubble as the local renderer (CodeBench-specific rendering logic). Align local ChangeType with DSBubbleChangeType naming, use DS color tokens for overlays."

7. While in each file, audit for any remaining issues:
   - Any UUID() patterns missed by Plan 02
   - Any layout computation still in body
   - Any accessibility issues (missing labels, contrast problems)
   Note findings but only fix what's within scope (colors/fonts/spacing).
  </action>
  <verify>
1. `grep -rn "import LeetPulseDesignSystem" CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView*.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift` returns matches in all 14 files
2. `grep -rn "Color\.red\|Color\.green\|Color\.blue\|Color\.yellow\|Color\.orange\|Color\.gray\|\.red\b\|\.green\b\|\.blue\b" CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTreeGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTrieGraphView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyStructureCanvasView*.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyHeapView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyMatrixGridView.swift CodeBench/CodeBench/DataJourney/Views/DataJourneyTraceBubble.swift` returns zero color literal matches (excluding Color.clear)
3. `grep -rn "dsTheme" CodeBench/CodeBench/DataJourney/Views/DataJourneyGraphView.swift` confirms environment theme is declared
  </verify>
  <done>Graph, tree, trie, structure canvas, heap, matrix, and bubble views all use DS tokens for colors, typography, and spacing. Diff colors use success/danger(25%)/warning per user decision. VizTypography kept for dense visualization text. All 14 files audited during sweep.</done>
</task>

</tasks>

<verification>
1. All 14 files in this plan have `import LeetPulseDesignSystem`
2. Zero hardcoded Color literals in the 14 files (excluding Color.clear)
3. Diff colors are: success green (added), danger red at 25% opacity (removed), warning amber (modified)
4. Categorical visualization uses Okabe-Ito palette from DS vizColors
5. TraceBubble ChangeType uses DS color tokens
6. Xcode project builds without errors
</verification>

<success_criteria>
- All 14 files import LeetPulseDesignSystem and use @Environment(\.dsTheme)
- Zero hardcoded Color/Font literals in these files (except VizTypography and Color.clear)
- Diff overlays use DS success/danger(25%)/warning tokens
- TraceBubble ChangeType aligned with DSBubbleChangeType naming
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-bug-fixes/01-03-SUMMARY.md`
</output>
